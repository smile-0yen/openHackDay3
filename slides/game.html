<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="js/d3.min.js"></script>
    <script src="js/epoch.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/epoch.min.css">
    <style>
      .gauges .epoch {
        display: inline-block;
      }
      #message1 {
        float: left;
        width: 50%;
      }
      #message2 {
        float: right;
        width: 50%;
      }
    </style>
  </head>
  <body>
    <embed src="sounds/battle.mp3" autostart="true" loop="true" height="0" width="0"></embed>
    <audio id="sound-file1" preload="auto">
      <source src="sounds/kick2.mp3" type="audio/mp3">
    </audio>
    <audio id="sound-file2" preload="auto">
      <source src="sounds/middle_punch2.mp3" type="audio/mp3">
    </audio>

    <div id="area" class="epoch category10" style="height: 200px;"></div>
    <div class="gauges">
      <div id="gaugeChart"  class="epoch gauge-large" style="position: relative;"></div>
      <img id="ninjaBlue" src="images/ninja_blue.png" height="200"/>
      <img id="ninjaOrange" src="images/ninja_orange.png" height="200" />
      <div id="gaugeChart2" class="epoch gauge-large" style="position: relative;"></div>
    </div>
    <div id="message">
      <h1 id="message1" style="position: relative;"></h1>
      <h1 id="message2" style="position: relative;"></h1>
    </div>
    <div>
      <small><font color="black">画像: Vectorartbox / 音楽: 魔王魂</font></small>
    </div>
    <div id="footer" width="900" height="50">
    </div>

    <script>
      var score1 = 0;
      var score2 = 0;

      var updateRate = 100;

      var player1 = 0;
      var player2 = 0;
      var player1_waza = "none";
      var player2_waza = "none";
      function updateData() {
        var request=new XMLHttpRequest();
        request.open("GET", './input', false);
        request.send("");
        var data = request.response.split(',');
        if (data && data.length >= 2) {
          player1 = data[0];
          score1 += parseFloat(player1);
          player2 = data[1];
          score2 += parseFloat(player2);
        }
        if (data && data.length >= 4) {
          player1_waza = data[2];
          player2_waza = data[3].replace(/\s+$/, "");
          console.dir("p1:"+player1_waza+":");
          console.dir("p2:"+player2_waza+":");
        } else {
          player1_waza = "none";
          player2_waza = "none";
        }
        setTimeout(function() { updateData(); },updateRate);
      }
      updateData();
            
      <!-- line graph  -->
      idx = ((new Date()).getTime()/1000)|0;
      var data = [
        { label: 'Layer 1', values: [ {time: idx, y: 0}] },
        { label: 'Layer 2', values: [ {time: idx, y: 0}] }
      ];

      var areaChartInstance = $('#area').epoch({
        type: 'time.line',
        data: data,
        axes: ['left', 'right', 'bottom']
      });

      var idx = 3;
      var nextData;

      function addData() {
        idx = ((new Date()).getTime()/1000)|0;
        nextData = [
          {time: idx, y: player1},{time: idx, y: player2}
        ];
        areaChartInstance.push(nextData);    
            
        setTimeout(function() { addData(); },updateRate/10);
      }
      addData();

      <!-- left hand side gauge  -->
      var value1 = 0;
      gaugeChartInstance = $('#gaugeChart').epoch({
        type: 'time.gauge',
        value: 1,
        format: function(v) { value1=v; return 'HP:' + (v*100).toFixed(2); }
      });

      <!-- right hand side gauge  -->
      var value2 = 0;
      gaugeChartInstance2 = $('#gaugeChart2').epoch({
        type: 'time.gauge',
        value: 1,
        format: function(v) { value2=v; return 'HP:' + (v*100).toFixed(2); }
      });

      var hp1 = 1;
      var hp2 = 1;

      function addValue() {
        var ninja1 = document.getElementById('ninjaBlue');
        var message1 = document.getElementById('message1');
        if (player1_waza == "attack") {
          message1.textContent = "攻撃!!";
<<<<<<< HEAD
          ninja1.src="images/ninja_blue_kick.png";
          hp2 = hp2 - (score1 / 100);
=======
          hp2 = hp2 - (score1 / 1000);
>>>>>>> 889264579d842fa43a5b6beadfd28cc3ffcd8246
          gaugeChartInstance2.push(hp2);
          score1 = 0;
          document.getElementById("sound-file1").play();
          if (hp2 < 0) {
            setTimeout(bluewin, 2000);
          }
        } else {
          ninja1.src="images/ninja_blue.png";
          message1.textContent = "戦闘力:" + score1.toFixed(2);
        }
        setTimeout(function() { addValue(); }, updateRate);
      }
      addValue();

      function addValue2() {
        var ninja2 = document.getElementById('ninjaOrange');
        var message2 = document.getElementById('message2');
        if (player2_waza == "attack") {
          message2.textContent = "攻撃!!";
<<<<<<< HEAD
          ninja2.src="images/ninja_orange_kick.png";
          hp1 = hp1 - (score2 / 100);
=======
          hp1 = hp1 - (score2 / 1000);
>>>>>>> 889264579d842fa43a5b6beadfd28cc3ffcd8246
          gaugeChartInstance.push(hp1);
          score2 = 0;
          document.getElementById("sound-file2").play();
          if (hp1 < 0) {
            setTimeout(orangewin, 2000);
          }
        } else {
          ninja2.src="images/ninja_orange.png";
          message2.textContent = "戦闘力:" + score2.toFixed(2);
        }
        setTimeout(function() { addValue2(); }, updateRate);
      }
      addValue2();

      function bluewin() {
        location.href="bluewin.html";
      }
      function orangewin() {
        location.href="orangewin.html";
      }
    </script>
  </body>
</html>
